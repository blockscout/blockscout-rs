name: 'Setup'
description: 'Checkout repository, setup rust toolchain and dependencies'

inputs:
  service-name:
    description: 'A directory name where the service target is located'
    required: true
  is-linting:
    description: 'If true, additional rustfmt and clippy components will be installed'
    required: false
    default: 'false'

runs:
  using: 'composite'
  steps:
    - name: Install deps
      uses: ./.github/actions/deps

#    - name: Install toolchain
#      uses: dtolnay/rust-toolchain
#      with:
#        toolchain: stable
#        components: rustfmt, clippy

    - name: Install toolchain
      uses: actions-rs/toolchain@v1
      if: ${{ inputs.is-linting == 'false' }}
      with:
        toolchain: stable
        profile: minimal
        components: rustfmt, clippy
        override: true

    - name: Install toolchain
      uses: actions-rs/toolchain@v1
      if: ${{ inputs.is-linting == 'true' }}
      with:
        toolchain: stable
        profile: minimal
        override: true

    - name: Rust cache
      uses: Swatinem/rust-cache@v2
      with:
        cache-on-failure: true
        workspaces: '${{ inputs.workspaces }} -> target'
