syntax = "proto3";

package blockscout.clusterExplorer.v1;

option go_package = "github.com/blockscout/blockscout-rs/multichain-aggregator";

import "v1/multichain-aggregator.proto";
import "google/protobuf/struct.proto";

service ClusterExplorerService {
  rpc ListClusterChains(ListClusterChainsRequest)
      returns (ListClusterChainsResponse) {}
  rpc ListInteropMessages(ListInteropMessagesRequest)
      returns (ListInteropMessagesResponse) {}
  rpc CountInteropMessages(CountInteropMessagesRequest)
      returns (CountInteropMessagesResponse) {}
  rpc GetInteropMessage(GetInteropMessageRequest)
      returns (GetInteropMessageResponse) {}
  rpc GetAddress(GetAddressRequest) returns (GetAddressResponse) {}
  rpc ListAddressTokens(ListAddressTokensRequest) returns (ListAddressTokensResponse) {}
  rpc ListClusterTokens(ListClusterTokensRequest) returns (ListClusterTokensResponse) {}
  rpc GetAggregatedToken(GetAggregatedTokenRequest) returns (GetAggregatedTokenResponse) {}
  rpc ListTokenHolders(ListTokenHoldersRequest) returns (ListTokenHoldersResponse) {}
  rpc SearchAddresses(SearchByQueryRequest) returns (SearchAddressesResponse) {}
  rpc SearchNfts(SearchByQueryRequest) returns (SearchNftsResponse) {}
  rpc SearchTransactions(SearchByQueryRequest) returns (SearchTransactionsResponse) {}
  rpc SearchBlocks(SearchByQueryRequest) returns (SearchBlocksResponse) {}
  rpc SearchBlockNumbers(SearchByQueryRequest) returns (SearchBlockNumbersResponse) {}
  rpc SearchTokens(SearchByQueryRequest) returns (SearchTokensResponse) {}
  rpc SearchDomains(SearchByQueryRequest) returns (SearchDomainsResponse) {}
  rpc QuickSearch(ClusterQuickSearchRequest) returns (ClusterQuickSearchResponse) {}
}

message AddressHash {
  string hash = 1;
}

message InteropMessage {
  enum Status {
    PENDING = 0;
    FAILED = 1;
    SUCCESS = 2;
    EXPIRED = 3;
  }

  message TokenDetails {
    string address_hash = 1;
  }

  message TransferTotal {
    string value = 1;
  }

  message InteropMessageTransfer {
    optional TokenDetails token = 1;
    AddressHash from = 2;
    AddressHash to = 3;
    TransferTotal total = 4;
  }

  optional AddressHash sender = 1;
  optional AddressHash target = 2;
  int64 nonce = 3;
  string init_chain_id = 4;
  optional string init_transaction_hash = 5;
  optional string timestamp = 6;
  string relay_chain_id = 7;
  optional string relay_transaction_hash = 8;
  optional string payload = 9;
  Status status = 10;
  optional InteropMessageTransfer transfer = 11;
  string message_type = 12;
  string method = 13;
  optional google.protobuf.Struct decoded_payload = 14;
}

message ListClusterChainsRequest {
  string cluster_id = 1;
}

message ListClusterChainsResponse {
  repeated blockscout.multichainAggregator.v1.Chain items = 1;
}

message ListInteropMessagesRequest {
  string cluster_id = 1;
  optional string init_chain_id = 2;
  optional string relay_chain_id = 3;
  optional int64 nonce = 4;
  // Address of the sender or receiver.
  optional string address = 5;
  // Message direction: "from" or "to". Valid only when address is provided.
  optional string direction = 6;
  optional uint32 page_size = 7;
  optional string page_token = 8;
}

message ListInteropMessagesResponse {
  repeated InteropMessage items = 1;
  blockscout.multichainAggregator.v1.Pagination next_page_params = 2;
}

message CountInteropMessagesRequest {
  string cluster_id = 1;
  string chain_id = 2;
}

message CountInteropMessagesResponse { uint64 count = 1; }

message GetInteropMessageRequest {
  string cluster_id = 1;
  string init_chain_id = 2;
  int64 nonce = 3;
}

message GetInteropMessageResponse { InteropMessage message = 1; }

message AggregatedTokenInfo {
  message ChainInfo {
    optional string holders_count = 1;
    optional string total_supply = 2;
  }

  string address_hash = 1;
  optional string circulating_market_cap = 2;
  optional string decimals = 3;
  optional string holders_count = 4;
  optional string icon_url = 5;
  optional string name = 6;
  optional string symbol = 7;
  optional string total_supply = 8;
  blockscout.multichainAggregator.v1.TokenType type = 9;
  optional string exchange_rate = 10;
  // Map of chain id to chain-specific information.
  map<string, ChainInfo> chain_infos = 11;
}

message GetAddressRequest {
  string cluster_id = 1;
  string address_hash = 2;
}

message GetAddressResponse {
  // Chain-specific information.
  message ChainInfo {
    string coin_balance = 1;
    bool is_contract = 2;
    bool is_verified = 3;
    optional string contract_name = 4;
  }

  string hash = 1;
  // Map of chain id to chain-specific information.
  map<string, ChainInfo> chain_infos = 2;
  bool has_tokens = 3;
  bool has_interop_message_transfers = 4;
}

message ListAddressTokensRequest {
  string cluster_id = 1;
  string address_hash = 2;
  // List of comma-separated token types to filter by. See `TokenType`.
  optional string type = 3;
  // Comma-separated list of chain ids to filter by.
  repeated string chain_id = 4;
  optional uint32 page_size = 5;
  optional string page_token = 6;
}

message ListAddressTokensResponse {
  message AggregatedTokenBalanceInfo {
    AggregatedTokenInfo token = 1;
    optional string token_id = 2;
    string value = 3;
    map<string, string> chain_values = 4;
  }

  repeated AggregatedTokenBalanceInfo items = 1;
  blockscout.multichainAggregator.v1.Pagination next_page_params = 2;
}

message ListClusterTokensRequest {
  string cluster_id = 1;
  // Comma-separated token types to filter by. See `TokenType`.
  optional string type = 2;
  // Comma-separated list of chain ids to filter by.
  repeated string chain_id = 3;
  optional uint32 page_size = 4;
  optional string page_token = 5;
}

message ListClusterTokensResponse {
  repeated AggregatedTokenInfo items = 1;
  blockscout.multichainAggregator.v1.Pagination next_page_params = 2;
}

message GetAggregatedTokenRequest {
  string cluster_id = 1;
  string address_hash = 2;
  string chain_id = 3;
}

message GetAggregatedTokenResponse {
  AggregatedTokenInfo token = 1;
}

message ListTokenHoldersRequest {
  string cluster_id = 1;
  string address_hash = 2;
  string chain_id = 3;
  optional uint32 page_size = 4;
  optional string page_token = 5;
}

message ListTokenHoldersResponse {
  message TokenHolder {
    AddressHash address = 1;
    optional string token_id = 2;
    string value = 3;    
  }

  repeated TokenHolder items = 1;
  blockscout.multichainAggregator.v1.Pagination next_page_params = 2;
}

message SearchByQueryRequest {
  string cluster_id = 1;
  string q = 2;
  // Comma-separated list of chain ids to filter by.
  repeated string chain_id = 3;
  optional uint32 page_size = 4;
  optional string page_token = 5;
}

message SearchTransactionsResponse {
  repeated blockscout.multichainAggregator.v1.Hash items = 1;
  blockscout.multichainAggregator.v1.Pagination next_page_params = 2;
}

message SearchBlocksResponse {
  repeated blockscout.multichainAggregator.v1.Hash items = 1;
  blockscout.multichainAggregator.v1.Pagination next_page_params = 2;
}

message SearchBlockNumbersResponse {
  repeated blockscout.multichainAggregator.v1.ChainBlockNumber items = 1;
  blockscout.multichainAggregator.v1.Pagination next_page_params = 2;
}

message SearchAddressesResponse {
  repeated GetAddressResponse items = 1;
  blockscout.multichainAggregator.v1.Pagination next_page_params = 2;
}

message SearchNftsResponse {
  repeated blockscout.multichainAggregator.v1.Address items = 1;
  blockscout.multichainAggregator.v1.Pagination next_page_params = 2;
}

message SearchTokensResponse {
  repeated blockscout.multichainAggregator.v1.Token items = 1;
  blockscout.multichainAggregator.v1.Pagination next_page_params = 2;
}

message SearchDomainsResponse {
  repeated blockscout.multichainAggregator.v1.Domain items = 1;
  blockscout.multichainAggregator.v1.Pagination next_page_params = 2;
}

message SearchDappsResponse {
  repeated blockscout.multichainAggregator.v1.MarketplaceDapp items = 1;
  blockscout.multichainAggregator.v1.Pagination next_page_params = 2;
}

message ClusterQuickSearchRequest {
  string cluster_id = 1;
  string q = 2; 
}

message ClusterQuickSearchResponse {
  repeated GetAddressResponse addresses = 1;
  repeated blockscout.multichainAggregator.v1.Hash blocks = 2;
  repeated blockscout.multichainAggregator.v1.Hash transactions = 3;
  repeated blockscout.multichainAggregator.v1.ChainBlockNumber block_numbers = 4;
  repeated blockscout.multichainAggregator.v1.MarketplaceDapp dapps = 5;
  repeated blockscout.multichainAggregator.v1.Token tokens = 6;
  repeated blockscout.multichainAggregator.v1.Address nfts = 7;
  repeated blockscout.multichainAggregator.v1.Domain domains = 8;
}
